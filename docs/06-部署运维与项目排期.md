# 宠物网需求文档 - 部署运维与项目排期

## 六、部署运维方案

### 6.1 部署架构

```
GitHub Repository
       │
       ├── Frontend (pet-web-frontend)
       │         │
       │         └──> Vercel (自动部署)
       │                 │
       │                 ├── CDN加速
       │                 ├── HTTPS证书
       │                 └── 域名绑定
       │
       └── Backend (pet-web-backend)
                 │
                 └──> Vercel Serverless Functions
                         │
                         ├── PostgreSQL (PlanetScale/Railway)
                         ├── Redis (Upstash)
                         └── OSS (Cloudinary/Vercel Blob)
```

### 6.2 Vercel 部署配置

#### 6.2.1 前端部署配置

**vercel.json (前端)**

```json
{
  "version": 2,
  "buildCommand": "npm run build",
  "outputDirectory": "dist",
  "framework": "vite",
  "devCommand": "npm run dev",
  "installCommand": "npm install",
  "env": {
    "VITE_API_BASE_URL": "@api-base-url",
    "VITE_CDN_URL": "@cdn-url"
  },
  "headers": [
    {
      "source": "/(.*)",
      "headers": [
        {
          "key": "X-Content-Type-Options",
          "value": "nosniff"
        },
        {
          "key": "X-Frame-Options",
          "value": "DENY"
        },
        {
          "key": "X-XSS-Protection",
          "value": "1; mode=block"
        }
      ]
    }
  ],
  "rewrites": [
    {
      "source": "/api/:path*",
      "destination": "https://api.yoursite.com/:path*"
    }
  ]
}
```

**package.json scripts:**

```json
{
  "scripts": {
    "dev": "vite",
    "build": "vue-tsc && vite build",
    "preview": "vite preview",
    "lint": "eslint . --ext .vue,.js,.jsx,.cjs,.mjs,.ts,.tsx,.cts,.mts --fix"
  }
}
```

#### 6.2.2 后端部署配置

**vercel.json (后端)**

```json
{
  "version": 2,
  "builds": [
    {
      "src": "src/server.ts",
      "use": "@vercel/node"
    }
  ],
  "routes": [
    {
      "src": "/api/(.*)",
      "dest": "src/server.ts"
    }
  ],
  "env": {
    "NODE_ENV": "production",
    "JWT_SECRET": "@jwt-secret",
    "DATABASE_URL": "@database-url",
    "REDIS_URL": "@redis-url"
  }
}
```

### 6.3 数据库部署

#### 6.3.1 PostgreSQL 部署方案

**选项 1：PlanetScale (推荐)**

- 免费套餐：5GB 存储，10 亿行读取/月
- 自动备份和恢复
- 分支管理（类似 Git）
- 全球 CDN 加速

**连接配置：**

```typescript
// config/database.ts
import { Sequelize } from "sequelize";

const sequelize = new Sequelize(process.env.DATABASE_URL!, {
  dialectOptions: {
    ssl: {
      rejectUnauthorized: true,
    },
  },
  logging: process.env.NODE_ENV === "development",
});

export default sequelize;
```

**选项 2：Railway**

- 免费套餐：512MB RAM，1GB 存储
- 自动备份
- 一键部署

#### 6.3.2 Redis 部署方案

**Upstash Redis (推荐)**

- 免费套餐：10,000 次请求/天
- Serverless 架构
- 全球边缘网络

**连接配置：**

```typescript
// config/redis.ts
import { Redis } from "@upstash/redis";

const redis = new Redis({
  url: process.env.UPSTASH_REDIS_REST_URL!,
  token: process.env.UPSTASH_REDIS_REST_TOKEN!,
});

export default redis;
```

### 6.4 文件存储方案

#### 6.4.1 Cloudinary 配置

```typescript
// config/cloudinary.ts
import { v2 as cloudinary } from "cloudinary";

cloudinary.config({
  cloud_name: process.env.CLOUDINARY_CLOUD_NAME,
  api_key: process.env.CLOUDINARY_API_KEY,
  api_secret: process.env.CLOUDINARY_API_SECRET,
});

export const uploadImage = async (file: Buffer) => {
  const result = await cloudinary.uploader.upload(file, {
    folder: "pet-web",
    resource_type: "auto",
  });
  return result.secure_url;
};
```

#### 6.4.2 Vercel Blob (备选)

```typescript
import { put } from "@vercel/blob";

export const uploadToBlob = async (file: File) => {
  const blob = await put(file.name, file, {
    access: "public",
  });
  return blob.url;
};
```

### 6.5 GitHub Actions CI/CD

**.github/workflows/deploy.yml**

```yaml
name: Deploy to Vercel

on:
  push:
    branches: [main]
  pull_request:
    branches: [main]

jobs:
  deploy-frontend:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3

      - name: Setup Node.js
        uses: actions/setup-node@v3
        with:
          node-version: "20"
          cache: "npm"

      - name: Install dependencies
        working-directory: ./frontend
        run: npm ci

      - name: Run tests
        working-directory: ./frontend
        run: npm test

      - name: Build
        working-directory: ./frontend
        run: npm run build

      - name: Deploy to Vercel
        uses: amondnet/vercel-action@v25
        with:
          vercel-token: ${{ secrets.VERCEL_TOKEN }}
          vercel-org-id: ${{ secrets.VERCEL_ORG_ID }}
          vercel-project-id: ${{ secrets.VERCEL_PROJECT_ID }}
          working-directory: ./frontend

  deploy-backend:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3

      - name: Setup Node.js
        uses: actions/setup-node@v3
        with:
          node-version: "20"
          cache: "npm"

      - name: Install dependencies
        working-directory: ./backend
        run: npm ci

      - name: Run tests
        working-directory: ./backend
        run: npm test

      - name: Deploy to Vercel
        uses: amondnet/vercel-action@v25
        with:
          vercel-token: ${{ secrets.VERCEL_TOKEN }}
          vercel-org-id: ${{ secrets.VERCEL_ORG_ID }}
          vercel-project-id: ${{ secrets.VERCEL_BACKEND_PROJECT_ID }}
          working-directory: ./backend
```

### 6.6 环境变量配置

#### 6.6.1 前端环境变量

**.env.development**

```bash
VITE_APP_TITLE=宠物网
VITE_API_BASE_URL=http://localhost:3000/api
VITE_CDN_URL=http://localhost:3000
```

**.env.production**

```bash
VITE_APP_TITLE=宠物网
VITE_API_BASE_URL=https://api.pet-web.com/api
VITE_CDN_URL=https://cdn.pet-web.com
```

#### 6.6.2 后端环境变量

**.env**

```bash
# 服务配置
NODE_ENV=production
PORT=3000

# 数据库
DATABASE_URL=postgres://user:password@host:5432/database

# Redis
REDIS_URL=redis://default:password@host:6379

# JWT
JWT_SECRET=your-secret-key-here
JWT_EXPIRES_IN=7d

# 文件上传
CLOUDINARY_CLOUD_NAME=your-cloud-name
CLOUDINARY_API_KEY=your-api-key
CLOUDINARY_API_SECRET=your-api-secret

# 支付配置
ALIPAY_APP_ID=your-app-id
ALIPAY_PRIVATE_KEY=your-private-key
WECHAT_APP_ID=your-app-id
WECHAT_APP_SECRET=your-app-secret
```

### 6.7 域名配置

#### 6.7.1 域名解析

| 记录类型 | 主机记录 | 记录值               | 用途          |
| -------- | -------- | -------------------- | ------------- |
| CNAME    | www      | cname.vercel-dns.com | 前端主域名    |
| CNAME    | api      | cname.vercel-dns.com | 后端 API 域名 |
| CNAME    | cdn      | cname.vercel-dns.com | CDN 加速域名  |
| A        | @        | Vercel IP            | 根域名        |

#### 6.7.2 SSL 证书

Vercel 自动提供 Let's Encrypt 免费 SSL 证书，支持：

- 自动续期
- 通配符证书
- 自定义域名

### 6.8 性能优化

#### 6.8.1 前端优化

**代码分割：**

```typescript
// router/index.ts
const routes = [
  {
    path: "/shop",
    component: () => import("@/views/shop/Index.vue"), // 懒加载
  },
];
```

**CDN 加速：**

```html
<!-- index.html -->
<link rel="preconnect" href="https://cdn.jsdelivr.net" />
<script src="https://cdn.jsdelivr.net/npm/vue@3"></script>
```

**图片优化：**

```vue
<template>
  <img :src="imageUrl" loading="lazy" alt="..." />
</template>
```

#### 6.8.2 后端优化

**数据库查询优化：**

```typescript
// 使用索引
const products = await Product.findAll({
  where: { categoryId: 1 },
  attributes: ["id", "name", "price"], // 只查询需要的字段
  limit: 20,
});

// 批量查询
const products = await Product.findAll({
  include: [
    { model: Category, attributes: ["name"] },
    { model: Brand, attributes: ["name"] },
  ],
});
```

**缓存策略：**

```typescript
// 热点数据缓存
const cacheKey = `product:${id}`;
let product = await redis.get(cacheKey);

if (!product) {
  product = await Product.findByPk(id);
  await redis.set(cacheKey, JSON.stringify(product), "EX", 3600);
}
```

### 6.9 监控告警

#### 6.9.1 性能监控

**集成 Vercel Analytics:**

```typescript
// main.ts
import { inject } from "@vercel/analytics";
inject();
```

**集成 Sentry 错误监控:**

```typescript
import * as Sentry from "@sentry/vue";

Sentry.init({
  app,
  dsn: process.env.VITE_SENTRY_DSN,
  environment: process.env.NODE_ENV,
  integrations: [new Sentry.BrowserTracing(), new Sentry.Replay()],
  tracesSampleRate: 1.0,
});
```

#### 6.9.2 日志管理

```typescript
// utils/logger.ts
import winston from "winston";

const logger = winston.createLogger({
  level: "info",
  format: winston.format.json(),
  transports: [
    new winston.transports.File({ filename: "error.log", level: "error" }),
    new winston.transports.File({ filename: "combined.log" }),
  ],
});

if (process.env.NODE_ENV !== "production") {
  logger.add(
    new winston.transports.Console({
      format: winston.format.simple(),
    })
  );
}

export default logger;
```

### 6.10 备份策略

#### 6.10.1 数据库备份

**PlanetScale 自动备份:**

- 每日自动备份
- 保留 30 天
- 一键恢复

**手动备份脚本:**

```bash
#!/bin/bash
# backup.sh

DATE=$(date +%Y%m%d_%H%M%S)
BACKUP_DIR="/backups"
DB_NAME="pet_web"

pg_dump -h $DB_HOST -U $DB_USER $DB_NAME > $BACKUP_DIR/backup_$DATE.sql

# 上传到云存储
aws s3 cp $BACKUP_DIR/backup_$DATE.sql s3://your-bucket/backups/
```

#### 6.10.2 代码备份

- GitHub 仓库作为主备份
- 使用 Git Tag 标记重要版本
- 设置受保护分支

---

## 七、项目排期与里程碑

### 7.1 项目总览

**项目周期：** 12 周（3 个月）

**团队配置：**

- 前端工程师：1 人
- 后端工程师：1 人（同一人）
- UI 设计师：外包
- 测试：开发兼任

### 7.2 详细排期

#### 第 1-2 周：需求分析与设计阶段

**第 1 周（Week 1）**

| 任务     | 工作内容           | 产出物       | 负责人 |
| -------- | ------------------ | ------------ | ------ |
| 需求整理 | 完成需求文档编写   | 需求文档     | 全员   |
| 竞品分析 | 研究 TOP5 竞品功能 | 竞品分析报告 | 全员   |
| 技术选型 | 确定技术栈         | 技术方案文档 | 开发   |

**第 2 周（Week 2）**

| 任务       | 工作内容           | 产出物         | 负责人 |
| ---------- | ------------------ | -------------- | ------ |
| 数据库设计 | 完成 ER 图和表结构 | 数据库设计文档 | 后端   |
| API 设计   | 定义接口规范       | API 接口文档   | 后端   |
| UI 设计    | 设计关键页面       | UI 设计稿      | 设计师 |
| 项目初始化 | 搭建前后端项目     | 项目骨架代码   | 开发   |

**里程碑 1：需求设计评审通过** ✅

#### 第 3-4 周：基础功能开发

**第 3 周（Week 3）**

| 模块   | 任务              | 进度 |
| ------ | ----------------- | ---- |
| 后端   | 用户注册登录 API  | 100% |
| 后端   | 商品分类/品牌管理 | 100% |
| 前端   | 登录注册页面      | 100% |
| 前端   | 首页框架搭建      | 100% |
| 数据库 | 创建核心表结构    | 100% |

**第 4 周（Week 4）**

| 模块 | 任务          | 进度 |
| ---- | ------------- | ---- |
| 后端 | 商品 CRUD API | 100% |
| 后端 | 购物车 API    | 100% |
| 前端 | 商品列表页    | 100% |
| 前端 | 商品详情页    | 100% |
| 前端 | 购物车页面    | 100% |

**里程碑 2：用户+商品模块完成** ✅

#### 第 5-6 周：核心交易功能

**第 5 周（Week 5）**

| 模块 | 任务             | 进度 |
| ---- | ---------------- | ---- |
| 后端 | 订单创建 API     | 100% |
| 后端 | 支付集成（模拟） | 100% |
| 前端 | 订单确认页       | 100% |
| 前端 | 支付页面         | 100% |
| 前端 | 订单列表页       | 100% |

**第 6 周（Week 6）**

| 模块 | 任务         | 进度 |
| ---- | ------------ | ---- |
| 后端 | 订单状态管理 | 100% |
| 后端 | 物流信息 API | 100% |
| 前端 | 订单详情页   | 100% |
| 前端 | 地址管理     | 100% |
| 测试 | 交易流程测试 | 100% |

**里程碑 3：订单交易闭环完成** ✅

#### 第 7-8 周：社区功能开发

**第 7 周（Week 7）**

| 模块 | 任务          | 进度 |
| ---- | ------------- | ---- |
| 后端 | 动态发布 API  | 100% |
| 后端 | 评论/点赞 API | 100% |
| 前端 | 动态广场页    | 100% |
| 前端 | 发布动态页    | 100% |
| 前端 | 图片上传组件  | 100% |

**第 8 周（Week 8）**

| 模块 | 任务         | 进度 |
| ---- | ------------ | ---- |
| 后端 | 话题管理 API | 100% |
| 后端 | 个人主页 API | 100% |
| 前端 | 动态详情页   | 100% |
| 前端 | 个人主页     | 100% |
| 前端 | 话题页面     | 100% |

**里程碑 4：社区模块完成** ✅

#### 第 9 周：后台管理系统

**第 9 周（Week 9）**

| 模块 | 任务         | 进度 |
| ---- | ------------ | ---- |
| 后端 | 后台权限系统 | 100% |
| 后端 | 商品管理 API | 100% |
| 后端 | 订单管理 API | 100% |
| 前端 | 后台登录页   | 100% |
| 前端 | Dashboard    | 100% |
| 前端 | 商品管理页   | 100% |
| 前端 | 订单管理页   | 100% |

**里程碑 5：后台管理系统完成** ✅

#### 第 10 周：响应式适配与优化

**第 10 周（Week 10）**

| 任务       | 工作内容             | 进度 |
| ---------- | -------------------- | ---- |
| 移动端适配 | 所有页面移动端优化   | 100% |
| 平板适配   | 关键页面平板优化     | 100% |
| 性能优化   | 图片懒加载、代码分割 | 100% |
| SEO 优化   | Meta 标签、sitemap   | 100% |

**里程碑 6：多端适配完成** ✅

#### 第 11 周：测试与修复

**第 11 周（Week 11）**

| 测试类型   | 测试内容           | 进度 |
| ---------- | ------------------ | ---- |
| 功能测试   | 核心功能验证       | 100% |
| 兼容性测试 | 浏览器/设备兼容    | 100% |
| 性能测试   | 页面加载速度       | 100% |
| 安全测试   | SQL 注入、XSS 防护 | 100% |
| Bug 修复   | 修复测试发现的问题 | 100% |

**里程碑 7：测试通过** ✅

#### 第 12 周：部署上线

**第 12 周（Week 12）**

| 任务       | 工作内容           | 进度 |
| ---------- | ------------------ | ---- |
| 数据库迁移 | 生产环境数据库部署 | 100% |
| 代码部署   | Vercel 部署配置    | 100% |
| 域名配置   | DNS 解析、SSL 证书 | 100% |
| 数据初始化 | 种子数据导入       | 100% |
| 上线验证   | 生产环境功能验证   | 100% |
| 文档整理   | 部署文档、用户手册 | 100% |

**里程碑 8：项目上线** 🎉

### 7.3 甘特图

```
任务/周次        1  2  3  4  5  6  7  8  9  10 11 12
需求设计        ███████
基础功能开发          ███████████
订单交易功能                ███████████
社区功能开发                      ███████████
后台管理系统                            ██████
响应式适配                                  ████
测试修复                                      ████
部署上线                                        ████
```

### 7.4 风险管理

| 风险             | 影响程度 | 应对措施                       |
| ---------------- | -------- | ------------------------------ |
| 技术难点攻关延期 | 高       | 提前技术预研，留足缓冲时间     |
| 需求变更频繁     | 中       | 严格控制需求变更，建立变更流程 |
| 第三方服务不稳定 | 中       | 准备备用方案，做好降级处理     |
| 人员变动         | 高       | 代码文档化，知识共享           |
| 性能不达标       | 中       | 提前压力测试，优化瓶颈点       |

### 7.5 项目验收标准

#### 功能验收

- ✅ 用户注册登录正常
- ✅ 商品浏览购买流程完整
- ✅ 订单创建支付流转正常
- ✅ 社区发布互动功能正常
- ✅ 后台管理功能完整
- ✅ 响应式适配良好

#### 性能验收

- ✅ 首屏加载时间 < 3 秒
- ✅ 接口响应时间 < 500ms
- ✅ 图片加载优化（懒加载）
- ✅ Lighthouse 分数 > 90

#### 安全验收

- ✅ HTTPS 加密传输
- ✅ SQL 注入防护
- ✅ XSS 攻击防护
- ✅ CSRF 防护
- ✅ 敏感数据加密

#### 兼容性验收

- ✅ Chrome 最新版
- ✅ Safari 最新版
- ✅ Firefox 最新版
- ✅ Edge 最新版
- ✅ 移动端 iOS/Android

---

## 八、后续迭代规划

### 8.1 V2.0 版本（上线后 3 个月）

**新增功能：**

- 🔥 直播带货功能
- 📹 短视频社区
- 🤖 AI 智能客服
- 🎮 宠物小游戏
- 🏆 积分会员体系

### 8.2 V3.0 版本（上线后 6 个月）

**新增功能：**

- 📱 小程序版本
- 🎯 精准推荐算法
- 📊 数据分析看板
- 🌍 多语言支持
- 🔗 区块链溯源

### 8.3 运营规划

**第 1 个月：种子用户**

- 目标：1000 注册用户
- 策略：邀请测试、KOL 合作

**第 2-3 个月：增长期**

- 目标：10000 注册用户
- 策略：社交裂变、内容营销

**第 4-6 个月：稳定期**

- 目标：50000 注册用户
- 策略：付费推广、品牌建设

---

## 总结

本需求文档涵盖了宠物网项目的：

1. ✅ **项目概述与竞品分析** - 明确市场定位和差异化策略
2. ✅ **前台功能详细设计** - 完整的用户端功能规划
3. ✅ **后台管理系统** - 强大的运营管理工具
4. ✅ **技术架构设计** - 现代化的技术栈选型
5. ✅ **数据库设计** - 规范的数据模型
6. ✅ **API 接口文档** - 详细的接口定义
7. ✅ **部署运维方案** - 完整的部署流程
8. ✅ **项目排期** - 清晰的开发计划

项目采用 Vue3+Vite+TypeScript 前端技术栈，Node.js+Express 后端技术栈，MySQL 数据库，部署在 Vercel 平台，实现全栈 TypeScript 开发，保证代码质量和开发效率。

下一步将按照排期开始项目开发！🚀
