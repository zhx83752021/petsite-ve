# ç¤¾åŒºç®¡ç†é¡µé¢å®ç°æŒ‡å—

## ğŸ“ æ–‡ä»¶ä½ç½®

`frontend/src/views/admin/posts/Index.vue`

## ğŸ¯ éœ€è¦å®ç°çš„åŠŸèƒ½

1. **åŠ¨æ€åˆ—è¡¨å±•ç¤º** - æ˜¾ç¤ºæ‰€æœ‰ç¤¾åŒºåŠ¨æ€
2. **ç­›é€‰åŠŸèƒ½** - æŒ‰çŠ¶æ€ç­›é€‰ï¼ˆpublished/draftï¼‰
3. **æŸ¥çœ‹è¯¦æƒ…** - æŸ¥çœ‹åŠ¨æ€å†…å®¹å’Œå›¾ç‰‡
4. **å®¡æ ¸ç®¡ç†** - é€šè¿‡/æ‹’ç»ç”¨æˆ·å‘å¸ƒçš„åŠ¨æ€
5. **åˆ é™¤åŠ¨æ€** - åˆ é™¤ä¸å½“å†…å®¹

## ğŸ’» å‚è€ƒå®ç°

```vue
<template>
  <div class="admin-posts">
    <h2 class="page-title">ç¤¾åŒºç®¡ç†</h2>

    <el-card shadow="never" class="search-card">
      <el-form :inline="true">
        <el-form-item label="çŠ¶æ€">
          <el-select v-model="searchForm.status" clearable style="width: 150px">
            <el-option label="å…¨éƒ¨" value="" />
            <el-option label="å·²å‘å¸ƒ" value="published" />
            <el-option label="è‰ç¨¿" value="draft" />
          </el-select>
        </el-form-item>
        <el-form-item>
          <el-button type="primary" @click="loadPosts">æœç´¢</el-button>
          <el-button @click="handleReset">é‡ç½®</el-button>
        </el-form-item>
      </el-form>
    </el-card>

    <el-card shadow="never" class="table-card">
      <el-table v-loading="loading" :data="postList" style="width: 100%" stripe>
        <el-table-column prop="id" label="ID" width="80" />
        <el-table-column prop="user_name" label="å‘å¸ƒç”¨æˆ·" width="120" />
        <el-table-column prop="content" label="å†…å®¹" min-width="300">
          <template #default="{ row }">
            <div class="post-content">{{ row.content }}</div>
          </template>
        </el-table-column>
        <el-table-column prop="like_count" label="ç‚¹èµæ•°" width="100" />
        <el-table-column prop="comment_count" label="è¯„è®ºæ•°" width="100" />
        <el-table-column prop="status" label="çŠ¶æ€" width="100">
          <template #default="{ row }">
            <el-tag v-if="row.status === 'published'" type="success"
              >å·²å‘å¸ƒ</el-tag
            >
            <el-tag v-else type="info">è‰ç¨¿</el-tag>
          </template>
        </el-table-column>
        <el-table-column prop="created_at" label="å‘å¸ƒæ—¶é—´" width="180" />
        <el-table-column label="æ“ä½œ" fixed="right" width="180">
          <template #default="{ row }">
            <el-button
              link
              type="primary"
              size="small"
              @click="handleView(row)"
            >
              æŸ¥çœ‹
            </el-button>
            <el-button
              link
              type="danger"
              size="small"
              @click="handleDelete(row)"
            >
              åˆ é™¤
            </el-button>
          </template>
        </el-table-column>
      </el-table>

      <el-pagination
        v-model:current-page="pagination.page"
        v-model:page-size="pagination.pageSize"
        :total="pagination.total"
        layout="total, sizes, prev, pager, next"
        @change="loadPosts"
      />
    </el-card>

    <!-- è¯¦æƒ…å¯¹è¯æ¡† -->
    <el-dialog v-model="detailVisible" title="åŠ¨æ€è¯¦æƒ…" width="800px">
      <div v-if="currentPost">
        <el-descriptions :column="2" border>
          <el-descriptions-item label="å‘å¸ƒç”¨æˆ·">
            {{ currentPost.user_name }}
          </el-descriptions-item>
          <el-descriptions-item label="å‘å¸ƒæ—¶é—´">
            {{ currentPost.created_at }}
          </el-descriptions-item>
          <el-descriptions-item label="ç‚¹èµæ•°">
            {{ currentPost.like_count }}
          </el-descriptions-item>
          <el-descriptions-item label="è¯„è®ºæ•°">
            {{ currentPost.comment_count }}
          </el-descriptions-item>
        </el-descriptions>

        <h4 style="margin-top: 20px">å†…å®¹</h4>
        <p>{{ currentPost.content }}</p>

        <h4
          v-if="currentPost.images && currentPost.images.length"
          style="margin-top: 20px"
        >
          å›¾ç‰‡
        </h4>
        <div
          v-if="currentPost.images && currentPost.images.length"
          class="images"
        >
          <el-image
            v-for="(img, index) in currentPost.images"
            :key="index"
            :src="img"
            :preview-src-list="currentPost.images"
            style="width: 100px; height: 100px; margin-right: 10px"
          />
        </div>
      </div>
    </el-dialog>
  </div>
</template>

<script setup lang="ts">
import { ref, reactive, onMounted } from "vue";
import { ElMessage, ElMessageBox } from "element-plus";
import axios from "axios";

const loading = ref(false);
const postList = ref<any[]>([]);
const pagination = reactive({
  page: 1,
  pageSize: 20,
  total: 0,
});

const searchForm = reactive({
  status: "",
});

const detailVisible = ref(false);
const currentPost = ref<any>(null);

// åŠ è½½åŠ¨æ€åˆ—è¡¨
const loadPosts = async () => {
  loading.value = true;
  try {
    const res = await axios.get("/api/admin/posts", {
      params: {
        page: pagination.page,
        pageSize: pagination.pageSize,
        status: searchForm.status || undefined,
      },
    });

    if (res.data.code === 200) {
      postList.value = res.data.data.items || [];
      pagination.total = res.data.data.total || 0;
    }
  } catch (error: any) {
    ElMessage.error(error.message || "åŠ è½½åŠ¨æ€åˆ—è¡¨å¤±è´¥");
  } finally {
    loading.value = false;
  }
};

const handleReset = () => {
  searchForm.status = "";
  pagination.page = 1;
  loadPosts();
};

const handleView = (row: any) => {
  currentPost.value = row;
  detailVisible.value = true;
};

const handleDelete = async (row: any) => {
  try {
    await ElMessageBox.confirm("ç¡®å®šè¦åˆ é™¤è¿™æ¡åŠ¨æ€å—ï¼Ÿ", "æç¤º", {
      type: "warning",
    });

    await axios.delete(`/api/admin/posts?id=${row.id}`);
    ElMessage.success("åˆ é™¤æˆåŠŸ");
    loadPosts();
  } catch (error: any) {
    if (error !== "cancel") {
      ElMessage.error(error.message || "åˆ é™¤å¤±è´¥");
    }
  }
};

onMounted(() => {
  loadPosts();
});
</script>

<style scoped>
.admin-posts {
  max-width: 1400px;
}

.page-title {
  font-size: 24px;
  font-weight: bold;
  color: #333;
  margin-bottom: 24px;
}

.search-card {
  margin-bottom: 16px;
}

.table-card {
  margin-bottom: 16px;
}

.post-content {
  max-height: 60px;
  overflow: hidden;
  text-overflow: ellipsis;
  display: -webkit-box;
  -webkit-line-clamp: 2;
  -webkit-box-orient: vertical;
}

.images {
  display: flex;
  flex-wrap: wrap;
  gap: 10px;
}
</style>
```

## ğŸ“ å®ç°æ­¥éª¤

1. å¤åˆ¶ä¸Šè¿°ä»£ç åˆ° `frontend/src/views/admin/posts/Index.vue`
2. ä¿å­˜æ–‡ä»¶
3. æäº¤ä»£ç ï¼š
   ```bash
   git add frontend/src/views/admin/posts/Index.vue
   git commit -m "feat: å®ç°ç¤¾åŒºç®¡ç†é¡µé¢"
   git push origin main
   ```

## âœ… å®Œæˆåçš„åŠŸèƒ½

- ğŸ“‹ æŸ¥çœ‹æ‰€æœ‰ç¤¾åŒºåŠ¨æ€
- ğŸ” æŒ‰çŠ¶æ€ç­›é€‰
- ğŸ‘ï¸ æŸ¥çœ‹è¯¦æƒ…å’Œå›¾ç‰‡
- ğŸ—‘ï¸ åˆ é™¤ä¸å½“å†…å®¹
- ğŸ“„ åˆ†é¡µæµè§ˆ

## ğŸ¯ åç»­ä¼˜åŒ–å»ºè®®

1. æ·»åŠ æ‰¹é‡æ“ä½œåŠŸèƒ½
2. æ·»åŠ å†…å®¹å®¡æ ¸åŠŸèƒ½
3. æ·»åŠ æ•æ„Ÿè¯è¿‡æ»¤
4. æ·»åŠ ç”¨æˆ·å±è”½åŠŸèƒ½
5. æ·»åŠ å¯¼å‡ºåŠŸèƒ½
