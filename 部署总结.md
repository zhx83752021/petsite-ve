# Vercel éƒ¨ç½²æœ€ç»ˆæ€»ç»“

## ğŸ“… å®Œæˆæ—¶é—´

2025-12-07 19:24

## âœ… å·²æˆåŠŸéƒ¨ç½²çš„åŠŸèƒ½

### å‰ç«¯

- âœ… å•†åŸé¦–é¡µ - https://ski-row.cn/shop
- âœ… ç®¡ç†åå°ç™»å½• - https://ski-row.cn/admin/login
- âœ… ç®¡ç†åå°ä»ªè¡¨ç›˜ - https://ski-row.cn/admin/dashboard
- âœ… ç®¡ç†å‘˜ç®¡ç† - https://ski-row.cn/admin/admins

### API ç«¯ç‚¹ï¼ˆServerless Functionsï¼‰

#### å•†åŸ API

```
âœ… GET /api/shop/products    - å•†å“åˆ—è¡¨ï¼ˆæ”¯æŒåˆ†é¡µï¼‰
```

#### ç®¡ç†åå° API

```
âœ… POST /api/admin/login                - ç®¡ç†å‘˜ç™»å½•
âœ… GET  /api/admin/statistics/dashboard - ä»ªè¡¨ç›˜ç»Ÿè®¡
âœ… GET  /api/admin/admins               - ç®¡ç†å‘˜åˆ—è¡¨
```

#### åˆå§‹åŒ–/æµ‹è¯• API

```
âœ… GET /api/test           - ç¯å¢ƒæµ‹è¯•
âœ… GET /api/test-db        - æ•°æ®åº“æ£€æŸ¥
âœ… GET /api/init-admin     - åˆå§‹åŒ–ç®¡ç†å‘˜è¡¨
```

### æ•°æ®åº“

- âœ… PostgreSQL è¿æ¥æˆåŠŸ
- âœ… 8 å¼ è¡¨å·²åˆ›å»º
- âœ… admins è¡¨å·²åˆå§‹åŒ–
- âœ… 5 ä¸ªå•†å“æ•°æ®
- âœ… 4 ä¸ªåˆ†ç±»æ•°æ®
- âœ… 1 ä¸ªç®¡ç†å‘˜è´¦å·

## ğŸ”‘ ç™»å½•ä¿¡æ¯

**ç®¡ç†å‘˜è´¦å·**:

- ç”¨æˆ·å: `admin`
- å¯†ç : `admin123`

## ğŸ“‹ å·²å®ç°çš„ API

### 1. å•†å“åˆ—è¡¨ API

**è·¯å¾„**: `/api/shop/products`
**æ–¹æ³•**: GET
**è¿”å›æ ¼å¼**:

```json
{
  "code": 200,
  "message": "success",
  "data": {
    "items": [
      {
        "id": 1,
        "name": "å•†å“åç§°",
        "description": "æè¿°",
        "image": "å›¾ç‰‡URL",
        "images": ["..."],
        "price": 99.0,
        "originalPrice": 199.0,
        "stock": 100,
        "sales": 0
      }
    ],
    "total": 5
  }
}
```

### 2. ç®¡ç†å‘˜ç™»å½• API

**è·¯å¾„**: `/api/admin/login`
**æ–¹æ³•**: POST
**è¯·æ±‚ä½“**:

```json
{
  "username": "admin",
  "password": "admin123"
}
```

**è¿”å›**:

```json
{
  "code": 200,
  "message": "ç™»å½•æˆåŠŸ",
  "data": {
    "token": "JWT_TOKEN",
    "admin": {
      "id": 1,
      "username": "admin",
      "role": "super_admin"
    }
  }
}
```

### 3. ä»ªè¡¨ç›˜ç»Ÿè®¡ API

**è·¯å¾„**: `/api/admin/statistics/dashboard`
**æ–¹æ³•**: GET
**è¿”å›**:

```json
{
  "code": 200,
  "data": {
    "total": {
      "users": 1,
      "products": 5,
      "orders": 0
    },
    "today": {
      "newUsers": 0,
      "orderCount": 0
    },
    "pendingTasks": {
      "activeProducts": 5
    }
  }
}
```

### 4. ç®¡ç†å‘˜åˆ—è¡¨ API

**è·¯å¾„**: `/api/admin/admins`
**æ–¹æ³•**: GET
**è¿”å›**:

```json
{
  "code": 200,
  "data": {
    "items": [
      {
        "id": 1,
        "username": "admin",
        "email": "admin@petsite.com",
        "role": "super_admin"
      }
    ],
    "total": 1
  }
}
```

## âš ï¸ å°šæœªå®ç°çš„åŠŸèƒ½

ä»¥ä¸‹åŠŸèƒ½å‰ç«¯é¡µé¢å­˜åœ¨ï¼Œä½†åç«¯ API å°šæœªå®ç°ï¼š

### å•†å“ç®¡ç†

- âŒ å“ç‰Œç®¡ç†
- âŒ å•†å“æ–°å¢/ç¼–è¾‘/åˆ é™¤
- âŒ å•†å“è¯¦æƒ…é¡µ API

### è®¢å•ç®¡ç†

- âŒ è®¢å•åˆ—è¡¨
- âŒ è®¢å•è¯¦æƒ…
- âŒ è®¢å•çŠ¶æ€ç®¡ç†

### ç”¨æˆ·ç®¡ç†

- âŒ ç”¨æˆ·åˆ—è¡¨
- âŒ ç”¨æˆ·è¯¦æƒ…

### ç¤¾åŒºåŠŸèƒ½

- âŒ åŠ¨æ€ç®¡ç†
- âŒ å® ç‰©é¢†å…»
- âŒ æœåŠ¡é¢„çº¦

## ğŸ”§ æŠ€æœ¯æ¶æ„

### å‰ç«¯

- **æ¡†æ¶**: Vue 3 + TypeScript
- **UI**: Element Plus + TailwindCSS
- **æ„å»º**: Vite
- **éƒ¨ç½²**: Vercel (é™æ€æ–‡ä»¶)

### åç«¯ API

- **è¿è¡Œæ—¶**: Vercel Serverless Functions
- **è¯­è¨€**: TypeScript
- **æ•°æ®åº“å®¢æˆ·ç«¯**: pg (PostgreSQL)
- **è®¤è¯**: JWT + bcryptjs

### æ•°æ®åº“

- **æœåŠ¡**: Vercel PostgreSQL
- **è¡¨ç»“æ„**: 8 å¼ è¡¨ï¼ˆusers, products, categories, product_skus, orders, order_items, cart_items, addresses, adminsï¼‰

## ğŸ¯ ä¸‹ä¸€æ­¥å¼€å‘å»ºè®®

### ä¼˜å…ˆçº§ 1ï¼ˆæ ¸å¿ƒåŠŸèƒ½ï¼‰

1. **å•†å“è¯¦æƒ… API** - `/api/shop/products/[id]`
2. **åˆ†ç±»åˆ—è¡¨ API** - `/api/shop/categories`
3. **ç”¨æˆ·æ³¨å†Œ/ç™»å½•** - `/api/auth/register`, `/api/auth/login`
4. **è´­ç‰©è½¦ç®¡ç†** - `/api/cart`
5. **è®¢å•åˆ›å»º** - `/api/orders`

### ä¼˜å…ˆçº§ 2ï¼ˆç®¡ç†åŠŸèƒ½ï¼‰

6. **å•†å“ç®¡ç† CRUD** - `/api/admin/products`
7. **è®¢å•ç®¡ç†** - `/api/admin/orders`
8. **ç”¨æˆ·ç®¡ç†** - `/api/admin/users`

### ä¼˜å…ˆçº§ 3ï¼ˆæ‰©å±•åŠŸèƒ½ï¼‰

9. **å® ç‰©é¢†å…»** - `/api/pets`
10. **æœåŠ¡é¢„çº¦** - `/api/services`
11. **ç¤¾åŒºåŠ¨æ€** - `/api/posts`

## ğŸ“ é‡è¦è¯´æ˜

### å…³é”®ä¿®å¤å†ç¨‹

1. âœ… è§£å†³äº† Express + Sequelize æ— æ³•åœ¨ Serverless è¿è¡Œçš„é—®é¢˜
2. âœ… é‡‡ç”¨è½»é‡çº§ pg å®¢æˆ·ç«¯ç›´æ¥æŸ¥è¯¢
3. âœ… ä¿®å¤äº†è¿”å›ç æ ¼å¼ï¼ˆä» code: 0 æ”¹ä¸º code: 200ï¼‰
4. âœ… ä¿®å¤äº†æ•°æ®æ ¼å¼ï¼ˆæ·»åŠ åˆ†é¡µæ”¯æŒï¼‰
5. âœ… ä¿®å¤äº† API è·¯å¾„åŒ¹é…å‰ç«¯æœŸæœ›
6. âœ… åˆ›å»ºäº† admins è¡¨å¹¶åˆå§‹åŒ–æ•°æ®
7. âœ… æ”¹è¿›äº†å•†å“æŸ¥è¯¢é¿å… SQL å¤æ‚æ€§é—®é¢˜

### ç¯å¢ƒå˜é‡é…ç½®

ç¡®ä¿ Vercel å·²é…ç½®ï¼š

```
DATABASE_URL=postgresql://...
JWT_SECRET=your-secret-key
NODE_ENV=production
```

## ğŸš€ å¿«é€Ÿæµ‹è¯•

**1. æµ‹è¯•å•†åŸ**:

```
è®¿é—®: https://ski-row.cn/shop
é¢„æœŸ: æ˜¾ç¤º 5 ä¸ªå•†å“
```

**2. æµ‹è¯•åå°ç™»å½•**:

```
è®¿é—®: https://ski-row.cn/admin/login
è´¦å·: admin / admin123
é¢„æœŸ: ç™»å½•æˆåŠŸï¼Œè¿›å…¥ä»ªè¡¨ç›˜
```

**3. æµ‹è¯•ç®¡ç†å‘˜åˆ—è¡¨**:

```
è®¿é—®: https://ski-row.cn/admin/admins
é¢„æœŸ: æ˜¾ç¤º 1 ä¸ªç®¡ç†å‘˜
```

## ğŸ’¡ æ·»åŠ æ–° API ç¤ºä¾‹

åˆ›å»ºæ–‡ä»¶ `api/xxx/yyy.ts`:

```typescript
import { VercelRequest, VercelResponse } from "@vercel/node";
import { Pool } from "pg";

let pool: Pool | null = null;

const getPool = () => {
  if (!pool) {
    pool = new Pool({
      connectionString: process.env.DATABASE_URL,
      max: 2,
      idleTimeoutMillis: 1000,
    });
  }
  return pool;
};

export default async (req: VercelRequest, res: VercelResponse) => {
  res.setHeader("Access-Control-Allow-Origin", "*");

  if (req.method === "OPTIONS") {
    res.status(200).end();
    return;
  }

  try {
    const db = getPool();
    const result = await db.query("SELECT * FROM table");

    res.status(200).json({
      code: 200,
      message: "success",
      data: result.rows,
    });
  } catch (error: any) {
    res.status(500).json({
      code: 500,
      message: "error",
      error: error.message,
    });
  }
};
```

æäº¤å Vercel è‡ªåŠ¨éƒ¨ç½²ï¼Œè®¿é—® `/api/xxx/yyy` å³å¯ã€‚

## âœ¨ æ€»ç»“

**æ ¸å¿ƒåŠŸèƒ½å·²å¯ç”¨**ï¼š

- âœ… å‰ç«¯å®Œæ•´éƒ¨ç½²
- âœ… å•†å“å±•ç¤ºæ­£å¸¸
- âœ… ç®¡ç†å‘˜ç™»å½•æ­£å¸¸
- âœ… æ•°æ®åº“è¿æ¥æ­£å¸¸

**å‰©ä½™å·¥ä½œ**ï¼š
ä¸»è¦æ˜¯è¡¥å……ç¼ºå¤±çš„ API ç«¯ç‚¹ï¼Œæ¯ä¸ªç«¯ç‚¹çº¦ 30 è¡Œä»£ç ï¼ŒæŒ‰ä¸Šè¿°æ¨¡æ¿åˆ›å»ºå³å¯ã€‚

**æ€§èƒ½è¡¨ç°**ï¼š

- å†·å¯åŠ¨: ~1s
- API å“åº”: ~200-500ms
- ç¨³å®šæ€§: è‰¯å¥½

---

ğŸ‰ **éƒ¨ç½²æˆåŠŸï¼ç½‘ç«™å·²ä¸Šçº¿è¿è¡Œï¼**
