# æ•°æ®åº“åˆå§‹åŒ–æŒ‡å—

## ğŸ“‹ å‡†å¤‡å·¥ä½œ

### 1. åœ¨ Vercel é…ç½®ç¯å¢ƒå˜é‡

è¿›å…¥ Vercel Project â†’ Settings â†’ Environment Variablesï¼Œæ·»åŠ ä»¥ä¸‹å˜é‡ï¼š

```env
# æ•°æ®åº“è¿æ¥ï¼ˆä»Vercel Postgresè·å–ï¼‰
DATABASE_URL=postgres://default:xxxxx@xxx-pooler.xxx.postgres.vercel-storage.com:5432/verceldb

# Nodeç¯å¢ƒ
NODE_ENV=production

# JWTé…ç½®
JWT_SECRET=ä½ çš„32ä½éšæœºå­—ç¬¦ä¸²
JWT_EXPIRES_IN=7d

# CORSé…ç½®
CORS_ORIGIN=https://petsite-ve.vercel.app

# æ•°æ®åº“åˆå§‹åŒ–å¯†é’¥ï¼ˆè‡ªå®šä¹‰ï¼Œç”¨äºä¿æŠ¤åˆå§‹åŒ–APIï¼‰
INIT_KEY=your-custom-secret-init-key-123456
```

### 2. ç”Ÿæˆ JWT_SECRET

åœ¨æœ¬åœ°ç»ˆç«¯è¿è¡Œï¼š

```bash
node -e "console.log(require('crypto').randomBytes(32).toString('hex'))"
```

å¤åˆ¶è¾“å‡ºçš„å­—ç¬¦ä¸²ä½œä¸º `JWT_SECRET` çš„å€¼ã€‚

### 3. è®¾ç½® INIT_KEY

INIT_KEY æ˜¯ç”¨äºä¿æŠ¤æ•°æ®åº“åˆå§‹åŒ– API çš„å¯†é’¥ï¼Œå¯ä»¥è‡ªå®šä¹‰ä»»æ„å­—ç¬¦ä¸²ï¼ˆå»ºè®® 16 ä½ä»¥ä¸Šï¼‰ã€‚

## ğŸš€ åˆå§‹åŒ–æ–¹å¼

### æ–¹å¼ä¸€ï¼šé€šè¿‡ API åˆå§‹åŒ–ï¼ˆæ¨èï¼‰

#### æ­¥éª¤ 1ï¼šæ£€æŸ¥æ•°æ®åº“çŠ¶æ€

```bash
# æ£€æŸ¥æ•°æ®åº“æ˜¯å¦å·²è¿æ¥
curl https://petsite-ve.vercel.app/api/init/status
```

è¿”å›ç¤ºä¾‹ï¼š

```json
{
  "code": 200,
  "message": "æ•°æ®åº“çŠ¶æ€æ­£å¸¸",
  "data": {
    "connected": true,
    "admins": 0,
    "categories": 0,
    "brands": 0,
    "initialized": false
  }
}
```

#### æ­¥éª¤ 2ï¼šæ‰§è¡Œåˆå§‹åŒ–

ä½¿ç”¨ Postmanã€curl æˆ–ä»»ä½• HTTP å®¢æˆ·ç«¯ï¼š

```bash
curl -X POST https://petsite-ve.vercel.app/api/init/database \
  -H "Content-Type: application/json" \
  -d '{"initKey": "your-custom-secret-init-key-123456"}'
```

**æ³¨æ„**ï¼š`initKey` å¿…é¡»ä¸ Vercel ç¯å¢ƒå˜é‡ä¸­çš„ `INIT_KEY` ä¸€è‡´ã€‚

æˆåŠŸè¿”å›ï¼š

```json
{
  "code": 200,
  "message": "æ•°æ®åº“åˆå§‹åŒ–æˆåŠŸ",
  "data": {
    "admin": {
      "username": "admin",
      "password": "admin123",
      "note": "é»˜è®¤ç®¡ç†å‘˜è´¦å·ï¼Œè¯·åŠæ—¶ä¿®æ”¹å¯†ç "
    },
    "categories": 5,
    "brands": 4
  }
}
```

#### æ­¥éª¤ 3ï¼šå†æ¬¡æ£€æŸ¥çŠ¶æ€

```bash
curl https://petsite-ve.vercel.app/api/init/status
```

åº”è¯¥çœ‹åˆ°ï¼š

```json
{
  "code": 200,
  "message": "æ•°æ®åº“çŠ¶æ€æ­£å¸¸",
  "data": {
    "connected": true,
    "admins": 1,
    "categories": 5,
    "brands": 4,
    "initialized": true
  }
}
```

### æ–¹å¼äºŒï¼šåœ¨ Vercel æ§åˆ¶å°æ‰§è¡Œ SQL

#### æ­¥éª¤ 1ï¼šæ‰“å¼€ Vercel Postgres æ§åˆ¶å°

1. è®¿é—® Vercel Dashboard
2. è¿›å…¥ Storage â†’ pet_web æ•°æ®åº“
3. ç‚¹å‡» **Query** æ ‡ç­¾é¡µ

#### æ­¥éª¤ 2ï¼šæ‰§è¡Œ SQL è„šæœ¬

å¤åˆ¶ `backend/scripts/init-database.sql` çš„å†…å®¹ï¼Œç²˜è´´åˆ° Query ç¼–è¾‘å™¨ä¸­æ‰§è¡Œã€‚

## ğŸ¯ åˆå§‹åŒ–åçš„é»˜è®¤æ•°æ®

### ç®¡ç†å‘˜è´¦å·

- **ç”¨æˆ·å**: `admin`
- **å¯†ç **: `admin123`
- âš ï¸ **é‡è¦**ï¼šé¦–æ¬¡ç™»å½•åè¯·ç«‹å³ä¿®æ”¹å¯†ç ï¼

### é»˜è®¤åˆ†ç±»

- ç‹—ç²®
- çŒ«ç²®
- é›¶é£Ÿ
- ç©å…·
- ç”¨å“

### é»˜è®¤å“ç‰Œ

- çš‡å®¶
- å† èƒ½
- æ¸´æœ›
- çˆ±è‚¯æ‹¿

## ğŸ“ æ•°æ®åº“è¡¨ç»“æ„

åˆå§‹åŒ–å®Œæˆåï¼Œå°†åˆ›å»ºä»¥ä¸‹æ•°æ®è¡¨ï¼š

1. **users** - ç”¨æˆ·è¡¨
2. **admins** - ç®¡ç†å‘˜è¡¨
3. **categories** - å•†å“åˆ†ç±»è¡¨
4. **brands** - å“ç‰Œè¡¨
5. **products** - å•†å“è¡¨
6. **product_skus** - å•†å“ SKU è¡¨
7. **orders** - è®¢å•è¡¨
8. **cart_items** - è´­ç‰©è½¦è¡¨

## ğŸ”§ æµ‹è¯•åˆå§‹åŒ–æ˜¯å¦æˆåŠŸ

### 1. æµ‹è¯•å¥åº·æ£€æŸ¥ API

```bash
curl https://petsite-ve.vercel.app/api/health
```

### 2. æµ‹è¯•ç®¡ç†å‘˜ç™»å½•

```bash
curl -X POST https://petsite-ve.vercel.app/api/admin/auth/login \
  -H "Content-Type: application/json" \
  -d '{
    "username": "admin",
    "password": "admin123"
  }'
```

æˆåŠŸè¿”å›åŒ…å« tokenï¼š

```json
{
  "code": 200,
  "message": "ç™»å½•æˆåŠŸ",
  "data": {
    "token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...",
    "admin": {
      "id": 1,
      "username": "admin",
      "realName": "ç³»ç»Ÿç®¡ç†å‘˜",
      ...
    }
  }
}
```

### 3. è®¿é—®å‰ç«¯

æ‰“å¼€æµè§ˆå™¨è®¿é—®ï¼š

```
https://petsite-ve.vercel.app/
```

å‰ç«¯åº”è¯¥èƒ½æ­£å¸¸æ˜¾ç¤ºï¼Œå¯ä»¥æ³¨å†Œç”¨æˆ·ã€æµè§ˆå•†å“ç­‰ã€‚

### 4. è®¿é—®åå°ç®¡ç†

```
https://petsite-ve.vercel.app/admin
```

ä½¿ç”¨é»˜è®¤ç®¡ç†å‘˜è´¦å·ç™»å½•ï¼š

- ç”¨æˆ·åï¼š`admin`
- å¯†ç ï¼š`admin123`

## âš ï¸ é‡è¦å®‰å…¨æç¤º

### 1. ä¿®æ”¹é»˜è®¤å¯†ç 

åˆå§‹åŒ–å®Œæˆåï¼Œç«‹å³ç™»å½•åå°ä¿®æ”¹ç®¡ç†å‘˜å¯†ç ï¼š

```
åå° â†’ ç³»ç»Ÿç®¡ç† â†’ ç®¡ç†å‘˜ç®¡ç† â†’ ä¿®æ”¹å¯†ç 
```

### 2. ç¦ç”¨åˆå§‹åŒ– APIï¼ˆæ¨èï¼‰

åˆå§‹åŒ–å®Œæˆåï¼Œä¸ºäº†å®‰å…¨ï¼Œå»ºè®®ç¦ç”¨åˆå§‹åŒ– APIï¼š

**æ–¹æ³• 1**ï¼šåˆ é™¤ Vercel ç¯å¢ƒå˜é‡ä¸­çš„ `INIT_KEY`ï¼Œç„¶åé‡æ–°éƒ¨ç½²

**æ–¹æ³• 2**ï¼šåœ¨ä»£ç ä¸­æ³¨é‡Šæ‰åˆå§‹åŒ–è·¯ç”±ï¼š

```typescript
// backend/src/routes/index.ts
// router.use('/init', initRoutes); // å·²å®Œæˆåˆå§‹åŒ–ï¼Œç¦ç”¨æ­¤è·¯ç”±
```

### 3. ä¿æŠ¤æ•æ„Ÿæ•°æ®

- ä¸è¦åœ¨å…¬å¼€åœºåˆåˆ†äº« `INIT_KEY`
- ä¸è¦åœ¨å‰ç«¯ä»£ç ä¸­ç¡¬ç¼–ç ä»»ä½•å¯†é’¥
- å®šæœŸè½®æ¢ `JWT_SECRET`

## ğŸ› å¸¸è§é—®é¢˜

### Q1: API è¿”å› 403 "æ— æƒé™æ‰§è¡Œæ­¤æ“ä½œ"

**åŸå› **ï¼š`initKey` ä¸ç¯å¢ƒå˜é‡ `INIT_KEY` ä¸åŒ¹é…

**è§£å†³**ï¼šç¡®è®¤ Vercel ç¯å¢ƒå˜é‡ä¸­çš„ `INIT_KEY` å€¼ï¼Œç¡®ä¿è¯·æ±‚ä¸­çš„ `initKey` ä¸€è‡´

### Q2: æ•°æ®åº“è¿æ¥å¤±è´¥

**åŸå› **ï¼šæ•°æ®åº“ç¯å¢ƒå˜é‡æœªé…ç½®æˆ–é…ç½®é”™è¯¯

**è§£å†³**ï¼š

1. æ£€æŸ¥ `DATABASE_URL` æ˜¯å¦æ­£ç¡®
2. ç¡®è®¤æ•°æ®åº“æœåŠ¡æ˜¯å¦æ­£å¸¸è¿è¡Œ
3. æŸ¥çœ‹ Vercel éƒ¨ç½²æ—¥å¿—ä¸­çš„è¯¦ç»†é”™è¯¯ä¿¡æ¯

### Q3: åˆå§‹åŒ–æˆåŠŸä½†æ— æ³•ç™»å½•

**åŸå› **ï¼šå¯èƒ½æ˜¯ JWT_SECRET æœªé…ç½®æˆ– CORS é—®é¢˜

**è§£å†³**ï¼š

1. ç¡®è®¤ `JWT_SECRET` å·²é…ç½®
2. ç¡®è®¤ `CORS_ORIGIN` è®¾ç½®æ­£ç¡®
3. æ£€æŸ¥æµè§ˆå™¨æ§åˆ¶å°æ˜¯å¦æœ‰ CORS é”™è¯¯

### Q4: è¡¨å·²å­˜åœ¨çš„é”™è¯¯

**åŸå› **ï¼šæ•°æ®åº“å·²ç»åˆå§‹åŒ–è¿‡

**è§£å†³**ï¼š

- ä½¿ç”¨ `/api/init/status` æ£€æŸ¥å½“å‰çŠ¶æ€
- å¦‚éœ€é‡æ–°åˆå§‹åŒ–ï¼Œå¯åœ¨ Vercel Postgres æ§åˆ¶å°æ‰‹åŠ¨åˆ é™¤è¡¨

## ğŸ“ è·å–å¸®åŠ©

å¦‚é‡åˆ°é—®é¢˜ï¼š

1. æ£€æŸ¥ Vercel éƒ¨ç½²æ—¥å¿—
2. æ£€æŸ¥æµè§ˆå™¨æ§åˆ¶å°é”™è¯¯
3. ä½¿ç”¨ `/api/init/status` æ£€æŸ¥æ•°æ®åº“çŠ¶æ€
4. æŸ¥çœ‹åç«¯æ—¥å¿—ï¼ˆVercel Function Logsï¼‰

---

**ç¥éƒ¨ç½²é¡ºåˆ©ï¼** ğŸ‰
