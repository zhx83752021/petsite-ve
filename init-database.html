<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>æ•°æ®åº“åˆå§‹åŒ–å·¥å…·</title>
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        min-height: 100vh;
        display: flex;
        align-items: center;
        justify-content: center;
        padding: 20px;
      }

      .container {
        background: white;
        border-radius: 20px;
        box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
        padding: 40px;
        max-width: 600px;
        width: 100%;
      }

      h1 {
        color: #333;
        text-align: center;
        margin-bottom: 10px;
        font-size: 28px;
      }

      .subtitle {
        text-align: center;
        color: #666;
        margin-bottom: 30px;
        font-size: 14px;
      }

      .warning {
        background: #fff3cd;
        border: 1px solid #ffc107;
        border-radius: 10px;
        padding: 15px;
        margin-bottom: 20px;
        color: #856404;
      }

      .warning strong {
        display: block;
        margin-bottom: 5px;
      }

      .info {
        background: #d1ecf1;
        border: 1px solid #17a2b8;
        border-radius: 10px;
        padding: 15px;
        margin-bottom: 20px;
        color: #0c5460;
      }

      .info ul {
        margin: 10px 0 0 20px;
      }

      .info li {
        margin: 5px 0;
      }

      button {
        width: 100%;
        padding: 15px;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        border: none;
        border-radius: 10px;
        font-size: 16px;
        font-weight: bold;
        cursor: pointer;
        transition: transform 0.2s, box-shadow 0.2s;
        margin-bottom: 20px;
      }

      button:hover:not(:disabled) {
        transform: translateY(-2px);
        box-shadow: 0 10px 20px rgba(0, 0, 0, 0.2);
      }

      button:disabled {
        opacity: 0.6;
        cursor: not-allowed;
      }

      #result {
        background: #f8f9fa;
        border-radius: 10px;
        padding: 20px;
        margin-top: 20px;
        max-height: 400px;
        overflow-y: auto;
        display: none;
      }

      #result.show {
        display: block;
      }

      .result-item {
        padding: 8px 0;
        border-bottom: 1px solid #dee2e6;
        font-size: 14px;
      }

      .result-item:last-child {
        border-bottom: none;
      }

      .result-item.success {
        color: #28a745;
      }

      .result-item.warning {
        color: #ffc107;
      }

      .result-item.error {
        color: #dc3545;
      }

      .loading {
        text-align: center;
        padding: 20px;
      }

      .spinner {
        border: 4px solid #f3f3f3;
        border-top: 4px solid #667eea;
        border-radius: 50%;
        width: 40px;
        height: 40px;
        animation: spin 1s linear infinite;
        margin: 0 auto 10px;
      }

      @keyframes spin {
        0% {
          transform: rotate(0deg);
        }
        100% {
          transform: rotate(360deg);
        }
      }
    </style>
  </head>
  <body>
    <div class="container">
      <h1>ğŸ—„ï¸ æ•°æ®åº“åˆå§‹åŒ–å·¥å…·</h1>
      <p class="subtitle">ä¸€é”®åˆå§‹åŒ–å® ç‰©ç½‘ç«™æ•°æ®åº“</p>

      <div class="warning">
        <strong>âš ï¸ æ³¨æ„äº‹é¡¹ï¼š</strong>
        è¿™ä¸ªå·¥å…·ä¼šè‡ªåŠ¨åˆ›å»ºç¼ºå¤±çš„è¡¨å¹¶æ’å…¥ç¤ºä¾‹æ•°æ®ã€‚å·²å­˜åœ¨çš„æ•°æ®ä¸ä¼šè¢«è¦†ç›–ã€‚
      </div>

      <div class="info">
        <strong>âœ¨ å°†ä¼šæ‰§è¡Œä»¥ä¸‹æ“ä½œï¼š</strong>
        <ul>
          <li>åˆ›å»º brands è¡¨å¹¶æ’å…¥5ä¸ªå“ç‰Œ</li>
          <li>åˆ›å»º posts è¡¨å¹¶æ’å…¥5æ¡åŠ¨æ€</li>
          <li>ä¸º categories å’Œ products è¡¨æ·»åŠ ç¼ºå¤±å­—æ®µ</li>
          <li>æ›´æ–°ç°æœ‰æ•°æ®çš„é»˜è®¤å€¼</li>
        </ul>
      </div>

      <button id="initBtn" onclick="initDatabase()">ğŸš€ å¼€å§‹åˆå§‹åŒ–</button>

      <div id="result"></div>
    </div>

    <script>
      async function initDatabase() {
        const btn = document.getElementById("initBtn");
        const resultDiv = document.getElementById("result");

        // ç¦ç”¨æŒ‰é’®
        btn.disabled = true;
        btn.textContent = "åˆå§‹åŒ–ä¸­...";

        // æ˜¾ç¤ºåŠ è½½åŠ¨ç”»
        resultDiv.className = "show";
        resultDiv.innerHTML = `
        <div class="loading">
          <div class="spinner"></div>
          <div>æ­£åœ¨åˆå§‹åŒ–æ•°æ®åº“...</div>
        </div>
      `;

        try {
          const response = await fetch("https://ski-row.cn/api/init-data", {
            method: "POST",
            headers: {
              "Content-Type": "application/json",
            },
          });

          const data = await response.json();

          if (data.code === 200) {
            // æ˜¾ç¤ºç»“æœ
            let html =
              '<h3 style="color: #28a745; margin-bottom: 15px;">âœ… åˆå§‹åŒ–å®Œæˆï¼</h3>';

            data.data.results.forEach((result) => {
              let className = "result-item ";
              if (result.includes("âœ…")) className += "success";
              else if (result.includes("âš ï¸")) className += "warning";
              else className += "error";

              html += `<div class="${className}">${result}</div>`;
            });

            resultDiv.innerHTML = html;
            btn.textContent = "âœ… åˆå§‹åŒ–å®Œæˆ";
            btn.style.background = "#28a745";

            // 3ç§’åæç¤ºåˆ·æ–°é¡µé¢
            setTimeout(() => {
              resultDiv.innerHTML += `
              <div style="margin-top: 20px; padding: 15px; background: #d4edda; border-radius: 8px; color: #155724; text-align: center;">
                <strong>ğŸ‰ æ•°æ®åº“å·²å‡†å¤‡å°±ç»ªï¼</strong><br>
                ç°åœ¨å¯ä»¥è®¿é—®ç½‘ç«™æŸ¥çœ‹æ•ˆæœäº†
              </div>
            `;
            }, 1000);
          } else {
            throw new Error(data.message || "åˆå§‹åŒ–å¤±è´¥");
          }
        } catch (error) {
          console.error("Error:", error);
          resultDiv.innerHTML = `
          <div class="result-item error">
            <strong>âŒ åˆå§‹åŒ–å¤±è´¥</strong><br>
            ${error.message}
          </div>
        `;
          btn.textContent = "é‡è¯•";
          btn.disabled = false;
        }
      }
    </script>
  </body>
</html>
